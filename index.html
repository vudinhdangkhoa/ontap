<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trắc nghiệm An ninh mạng</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <h1>Trắc nghiệm An toàn mạng máy tính</h1>
        <p id="progress-text">Đang tải câu hỏi...</p>
    </header>

    <main>
        <div id="quiz-container">
            <div id="score-container" style="display: none;">
                <h2>số câu đúng</h2>
                <p id="final-score"></p>
            </div>
            <div id="question-card">
                <h2 id="question-text"></h2>
                <div id="options-container"></div>
                <div id="feedback"></div>
            </div>

            <div id="navigation-bar">
                <button id="next-btn" class="nav-btn">Câu tiếp ➡️</button>
            </div>

            <!-- Modal kết quả -->
            <div id="modal-overlay" class="hidden">
                <div id="result-modal" role="dialog" aria-modal="true">
                    <h2>Kết quả</h2>
                    <p id="modal-score-text"></p>
                    <div class="modal-actions">
                        <button id="restart-btn" class="nav-btn">Làm lại</button>
                        <button id="close-modal-btn" class="nav-btn">Đóng</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Các đối tượng DOM
            const progressText = document.getElementById('progress-text');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');
            const scoreContainer = document.getElementById('score-container');
            const finalScore = document.getElementById('final-score');
            // Modal elements
            const modalOverlay = document.getElementById('modal-overlay');
            const modalScoreText = document.getElementById('modal-score-text');
            const restartBtn = document.getElementById('restart-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            // Biến trạng thái
            let allQuestions = [];
            let currentQuestionIndex = 0;
            let answered = false; // Biến cờ để xem câu hiện tại đã được trả lời chưa
            
            //số câu hỏi trả lời đúng
            let correctAnswersCount = 0;

            // Tải dữ liệu câu hỏi
            fetch('questions.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Không tìm thấy tệp questions.json');
                    }
                    return response.json();
                })
                .then(questions => {
                    allQuestions = questions;
                    // Kiểm tra xem có câu hỏi nào không
                    if (allQuestions.length > 0) {
                        showQuestion(currentQuestionIndex);
                    } else {
                        progressText.textContent = "Không có câu hỏi nào được tải.";
                    }
                })
                .catch(error => {
                    console.error('Lỗi khi tải JSON:', error);
                    progressText.textContent = 'Không thể tải được câu hỏi. Vui lòng kiểm tra lại tệp questions.json và đảm bảo bạn đang chạy trên một máy chủ (ví dụ: Live Server).';
                    document.getElementById('question-card').style.display = 'none';
                    document.getElementById('navigation-bar').style.display = 'none';
                });

            // Hàm hiển thị câu hỏi
            function showQuestion(index) {
                // Lấy dữ liệu câu hỏi hiện tại
                const q = allQuestions[index];
                if (!q) return;

                // Đặt lại trạng thái
                answered = false;
                feedback.style.display = 'none';
                feedback.className = 'feedback';
                optionsContainer.innerHTML = ''; // Xóa các lựa chọn cũ

                // Cập nhật nội dung
                progressText.textContent = `Câu ${index + 1} / ${allQuestions.length}`;
                questionText.textContent = q.question;

                // Tạo các nút lựa chọn
                q.options.forEach(option => {
                    const optionButton = document.createElement('button');
                    optionButton.className = 'option';
                    optionButton.textContent = option;
                    
                    optionButton.addEventListener('click', () => {
                        handleAnswer(optionButton, option, q.answer);
                    });

                    optionsContainer.appendChild(optionButton);
                });

                // Cập nhật trạng thái nút điều hướng
                updateNavButtons();
            }

            // Hàm xử lý khi chọn đáp án
            function handleAnswer(selectedButton, selectedAnswer, correctAnswer) {
                if (answered) return; // Nếu đã trả lời rồi thì không làm gì cả
                answered = true;

                const buttons = optionsContainer.getElementsByClassName('option');
                
                // Vô hiệu hóa tất cả các nút
                Array.from(buttons).forEach(button => {
                    button.disabled = true;
                    // Tìm và tô sáng đáp án đúng
                    if (button.textContent === correctAnswer) {
                        button.classList.add('correct');
                    }
                });

                // Kiểm tra đáp án
                if (selectedAnswer === correctAnswer) {
                    selectedButton.classList.add('correct');
                    feedback.textContent = '✅ Chính xác!';
                    feedback.classList.add('correct');
                    correctAnswersCount++; // Tăng số câu trả lời đúng
                } else {
                    selectedButton.classList.add('incorrect');
                    feedback.innerHTML = `❌ Sai. Đáp án đúng là: <strong>${correctAnswer}</strong>`;
                    feedback.classList.add('incorrect');
                }

                feedback.style.display = 'block';

                // Nếu là câu cuối cùng, hiện modal kết quả
                if (currentQuestionIndex === allQuestions.length - 1) {
                    showResultModal();
                }

                updateNavButtons(); // Cập nhật lại nút (để kích hoạt nút "Next")
            }

            // Hàm cập nhật trạng thái nút "Next"
            function updateNavButtons() {
                // Nút "Câu tiếp": ẩn ở câu cuối cùng (modal sẽ hiện kết quả)
                if (currentQuestionIndex === allQuestions.length - 1) {
                    nextBtn.style.visibility = 'hidden';
                } else {
                    nextBtn.style.visibility = 'visible';
                }

                // Chỉ cho phép "Câu tiếp" nếu đã trả lời
                nextBtn.disabled = !answered;
            }

            // Gán sự kiện cho nút tiếp theo
            nextBtn.addEventListener('click', () => {
                if (currentQuestionIndex < allQuestions.length - 1) {
                    currentQuestionIndex++;
                    showQuestion(currentQuestionIndex);
                }
            });

            // Modal functions
            function showResultModal() {
                modalScoreText.textContent = `Bạn đã trả lời đúng ${correctAnswersCount} / ${allQuestions.length} câu hỏi.`;
                modalOverlay.classList.remove('hidden');
                modalOverlay.style.display = 'flex';
            }

            function hideResultModal() {
                modalOverlay.classList.add('hidden');
                modalOverlay.style.display = 'none';
            }

            // Restart quiz
            function restartQuiz() {
                correctAnswersCount = 0;
                currentQuestionIndex = 0;
                hideResultModal();
                showQuestion(currentQuestionIndex);
            }

            closeModalBtn.addEventListener('click', () => {
                hideResultModal();
            });

            restartBtn.addEventListener('click', () => {
                restartQuiz();
            });
        });
    </script>
</body>
</html>